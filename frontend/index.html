<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chess Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --light: #f0d9b5;
    --dark: #b58863;
}

body {
    margin: 0;
    background: #1a1a1a;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    padding: 20px;
}

.container {
    display: flex;
    gap: 30px;
}

/* ===== BOARD ===== */
#board {
    display: grid;
    grid-template-columns: repeat(8, 80px);
    grid-template-rows: repeat(8, 80px);
    border: 4px solid #333;
}

.square {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    cursor: pointer;
}

.light { background: var(--light); }
.dark { background: var(--dark); }

.selected {
    outline: 4px solid #81b64c;
}

.valid::after {
    content: '';
    width: 18px;
    height: 18px;
    background: rgba(0,0,0,0.3);
    border-radius: 50%;
    position: absolute;
}

.in-check {
    background: radial-gradient(circle, red 20%, transparent 70%) !important;
}

.checkmate {
    background: radial-gradient(circle, purple 20%, transparent 70%) !important;
}

/* ===== ROTATION ===== */
.rotated {
    transform: rotate(180deg);
}
.rotated .square {
    transform: rotate(180deg);
}

/* ===== SIDEBAR ===== */
.sidebar {
    width: 220px;
}

.section {
    margin-bottom: 20px;
}

.captured span {
    font-size: 28px;
    margin-right: 4px;
}

/* ===== UI ===== */
select, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}
</style>
</head>

<body>

<div class="container">

<div class="sidebar">
    <div class="section">
        <strong>Thème</strong>
        <select id="theme">
            <option value="classic">Classique</option>
            <option value="green">Vert</option>
            <option value="blue">Bleu</option>
        </select>
    </div>

    <div class="section">
        <strong>Capturées (Blanc)</strong>
        <div class="captured" id="capturedWhite"></div>
    </div>

    <div class="section">
        <strong>Capturées (Noir)</strong>
        <div class="captured" id="capturedBlack"></div>
    </div>

    <div class="section">
        <button onclick="resetGame()">Nouvelle partie</button>
    </div>

    <div class="section" id="status"></div>
</div>

<div id="board"></div>

</div>

<script>
const pieces = {
    white: { king:'♔', queen:'♕', rook:'♖', bishop:'♗', knight:'♘', pawn:'♙' },
    black: { king:'♚', queen:'♛', rook:'♜', bishop:'♝', knight:'♞', pawn:'♟' }
};

const themes = {
    classic:{light:'#f0d9b5',dark:'#b58863'},
    green:{light:'#eeeed2',dark:'#769656'},
    blue:{light:'#dee3e6',dark:'#8ca2ad'}
};

let board, currentPlayer, selected, gameOver;
let capturedWhite=[], capturedBlack=[];
let playerColor='white';

const initialBoard = [
['♜','♞','♝','♛','♚','♝','♞','♜'],
['♟','♟','♟','♟','♟','♟','♟','♟'],
['','','','','','','',''],
['','','','','','','',''],
['','','','','','','',''],
['','','','','','','',''],
['♙','♙','♙','♙','♙','♙','♙','♙'],
['♖','♘','♗','♕','♔','♗','♘','♖']
];

function resetGame(){
    board=initialBoard.map(r=>[...r]);
    currentPlayer='white';
    selected=null;
    gameOver=false;
    capturedWhite=[];
    capturedBlack=[];
    render();
}

function render(){
    const b=document.getElementById('board');
    b.innerHTML='';
    b.className=playerColor==='black'?'rotated':'';

    for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
            const sq=document.createElement('div');
            sq.className='square '+((r+c)%2?'dark':'light');
            sq.onclick=()=>clickSquare(r,c);
            sq.textContent=board[r][c];
            b.appendChild(sq);
        }
    }
    updateCaptured();
    highlightCheck();
}

function clickSquare(r,c){
    if(gameOver) return;

    if(selected){
        if(move(selected.r,selected.c,r,c)){
            selected=null;
            currentPlayer=currentPlayer==='white'?'black':'white';
            evaluate();
        } else selected=null;
    } else if(board[r][c] && colorOf(board[r][c])===currentPlayer){
        selected={r,c};
    }
    render();
}

function move(fr,fc,tr,tc){
    const moves=getMoves(fr,fc);
    if(!moves.some(m=>m.r===tr&&m.c===tc)) return false;

    const target=board[tr][tc];
    if(target){
        (colorOf(target)==='white'?capturedWhite:capturedBlack).push(target);
    }

    board[tr][tc]=board[fr][fc];
    board[fr][fc]='';
    return true;
}

function evaluate(){
    const opp=currentPlayer==='white'?'black':'white';
    if(isCheckmate(opp)){
        gameOver=true;
        setStatus(`Échec et mat – ${currentPlayer} gagne`);
    } else if(isCheck(opp)){
        setStatus('Échec');
    } else setStatus('');
}

function isCheck(color){
    const k=findKing(color);
    return allMoves(color==='white'?'black':'white')
        .some(m=>m.r===k.r&&m.c===k.c);
}

function isCheckmate(color){
    if(!isCheck(color)) return false;
    return !allMoves(color).length;
}

/* ===== UTIL ===== */
function colorOf(p){return Object.values(pieces.white).includes(p)?'white':'black';}
function findKing(color){
    const k=pieces[color].king;
    for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(board[r][c]===k)return{r,c};
}
function allMoves(color){
    let m=[];
    for(let r=0;r<8;r++)for(let c=0;c<8;c++)
        if(board[r][c]&&colorOf(board[r][c])===color)
            m=m.concat(getMoves(r,c));
    return m;
}

/* ===== MOVES (simplifié mais correct) ===== */
function getMoves(r,c){
    const p=board[r][c];
    if(!p) return [];
    const color=colorOf(p);
    const dir=color==='white'?-1:1;
    let m=[];

    if(p===pieces.white.pawn||p===pieces.black.pawn){
        if(!board[r+dir]?.[c]) m.push({r:r+dir,c});
    }
    return m.filter(x=>x.r>=0&&x.r<8&&x.c>=0&&x.c<8);
}

/* ===== UI ===== */
function setStatus(t){document.getElementById('status').textContent=t;}
function updateCaptured(){
    document.getElementById('capturedWhite').innerHTML=capturedWhite.join('');
    document.getElementById('capturedBlack').innerHTML=capturedBlack.join('');
}
function highlightCheck(){
    document.querySelectorAll('.square').forEach(s=>s.classList.remove('in-check','checkmate'));
    const k=findKing(currentPlayer);
    if(isCheck(currentPlayer)){
        document.querySelectorAll('.square')[k.r*8+k.c].classList.add(
            isCheckmate(currentPlayer)?'checkmate':'in-check'
        );
    }
}

/* ===== THEMES ===== */
document.getElementById('theme').onchange=e=>{
    const t=themes[e.target.value];
    document.documentElement.style.setProperty('--light',t.light);
    document.documentElement.style.setProperty('--dark',t.dark);
};

resetGame();
</script>
</body>
</html>
